<head>
  <title>HBMC Comparison</title>
   <script src="plotly-latest.min.js"></script>
</head>

<body>
  <div id="myDiv"></div>
  <select id="left" size="9"></select>
  <select id="right" size="9"></select>
  <script>
    function get(url, k) {
      var xmlHttp = new XMLHttpRequest();
      xmlHttp.onreadystatechange = function() {
          if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
              k(xmlHttp.responseText);
      }
      xmlHttp.open("GET", url, true);
      xmlHttp.send(null);
    }

    function proc(d) {
      var r = {};
      d.split("\n").map(function(line) {
        var x = line.split(",")
        var b = x[0].split("/")[2];
        if (b != undefined) {
          b = b.split(".")[0];
        }
        var t = x[1];
        if (t == '-') {
          t = 60;
        }
        r[b] = t;
      });
      return r;
    }

    function plot(ax1,ax2,t1,t2) {
      var data = [];
      var min = 100000, max = 0;
      for(var k in t1) {
        data.push(
          { x: [t1[k]]
          , y: [t2[k]]
          , text: k
          , type: 'scatter'
          , mode: 'markers'
          , marker: {size: 10}
          , hoverinfo: 'text'
          });
        if (t1[k] < min) { min = t1[k]; }
        if (t2[k] < min) { min = t2[k]; }
        if (t1[k] > max) { max = t1[k]; }
        if (t2[k] > max) { max = t2[k]; }
      }

      data.push(
        { x: [min/2, max*2]
        , y: [min/2, max*2]
        , mode: "lines"
        , line: {
            color: 'rgb(0,0,0)',
            width: 1
        }
        });

      var layout = {
        xaxis: {title: ax1, type: 'log', fixedrange: true},
        yaxis: {title: ax2, type: 'log', fixedrange: true},
        width: 800,
        height: 800,
        // autosize: true,
        hovermode: 'closest',
        showlegend: false
      };

      Plotly.newPlot('myDiv', data, layout);
    }

    function go(ax2,ax1) {
      get(ax1, function(d1) {
        get(ax2, function(d2) {
          plot(ax1,ax2,proc(d1),proc(d2));
        });
      });
    }

    var options =
      "hbmc-symbo-old_-q_ hbmc-symbo_-q_ hbmc-symbo_-q_--always-later_ hbmc-symbo_-q_--lazy-enums_ hbmc-symbo_-q_--memo=False_ hbmc-symbo_-q_--memo=False_--always-later_ hbmc-symbo_-q_--memo=False_--lazy-enums_ hbmc-symbo_-q_--memo=False_--top-level-bool-ops_ hbmc_-q_".split(" ");
    go(options[0], options[1]);

    function update() {
      var l = document.getElementById("left");
      var r = document.getElementById("right");
      go(l.options[l.selectedIndex].text,r.options[r.selectedIndex].text);
    }

    for (var d=0; d<2; d++) {
      for (var i=0; i<options.length; i++) {
        var sel = document.getElementById(["left","right"][d])
        var opt = document.createElement("option");
        opt.text = options[i]
        sel.add(opt);
        if (i == d) {
          sel.selectedIndex = i;
          sel.addEventListener("change", update, false);
        }
      }
    }
  </script>
</body>


